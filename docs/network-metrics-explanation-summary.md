# Network Correlation 指标解释功能 - 设计总结

## 📋 需求概述

为 Network Correlation 展开状态添加网络指标的通俗易懂解释，帮助非网络岗位用户理解网络指标变化对交易性能的影响。

---

## 🎯 核心设计理念

### 1. 用户友好
- **通俗语言**：使用生活化比喻解释专业术语
- **因果关系**：明确说明网络指标如何影响交易性能
- **行动建议**：异常时提供初步排查方向

### 2. 按需显示
- **不干扰主流程**：信息图标小巧，不占用过多空间
- **主动获取**：用户点击图标才显示详细解释
- **快速关闭**：支持多种关闭方式（点击外部、ESC、关闭按钮）

### 3. 视觉一致
- **遵循设计规范**：配色、字体、间距与整体风格一致
- **状态可视化**：用颜色和图标直观表示指标状态
- **响应式适配**：桌面、平板、移动端都有良好体验

---

## 📊 覆盖的网络指标

### Performance 指标组（网络性能）

| 指标 | 英文名 | 通俗解释 | 正常范围 |
|------|--------|----------|----------|
| 丢包率 | Packet Loss | 像快递丢失，需要重新寄送 | < 1% |
| 重传率 | Retransmission | 像对方没听清，需要重复说 | < 2% |
| 重复确认 | Duplicate ACK | 像收到错误的包裹，一直说"不是这个" | < 3% |

### Availability 指标组（网络可用性）

| 指标 | 英文名 | 通俗解释 | 正常范围 |
|------|--------|----------|----------|
| TCP 建连成功率 | TCP Setup Success | 像打电话能否接通 | > 99.5% |
| TCP 连接重置 | TCP RST | 像电话突然被挂断 | < 1% |

---

## 🎨 UI 设计要点

### 信息图标
```
位置: Legend 中每个指标名称后
样式: ⓘ 图标，14px × 14px
颜色: 默认灰色，悬停蓝色，激活深蓝
交互: 悬停放大 1.1 倍，点击显示浮层
```

### 浮层卡片
```
尺寸: 320px 宽，最大 400px 高
定位: 智能定位（右侧优先，空间不足时左侧）
动画: 淡入 + 缩放，200ms
内容: 定义、解释、影响、状态、原因
```

### 状态颜色
```
✅ 正常: green-600 / green-400
⚠️ 轻微影响: amber-600 / amber-400
🔴 严重影响: red-600 / red-400
```

---

## 💡 内容设计示例

### Packet Loss（丢包率）

**定义**
> 网络传输过程中数据包丢失的比例

**通俗解释**
> 就像寄快递时包裹丢失，需要重新寄送。丢包率越高，数据传输越不可靠。

**对交易的影响**
- 交易响应时间变长（需要重传丢失的数据）
- 交易失败率上升（重传超时或连接中断）
- 用户体验下降（页面加载缓慢、操作卡顿）

**当前状态**（示例）
> ⚠️ 轻微影响 - 丢包率 2.5%（正常 <1%）

**可能原因**
- 网络设备故障或过载（交换机、路由器）
- 物理链路质量差（网线、光纤老化）
- 防火墙或安全设备策略导致丢包
- 网络拥塞（带宽不足）

---

## 🔧 技术实现架构

### 组件层次
```
NetworkCorrelationSidebar
  └── CustomLegend
        └── MetricInfoTooltip (×5)
              ├── Info Icon
              └── Tooltip Portal
```

### 核心文件
```
src/
├── components/
│   ├── MetricInfoTooltip.tsx          (新建)
│   └── NetworkCorrelationSidebar.tsx  (修改)
├── config/
│   └── networkMetricsConfig.ts        (新建)
├── utils/
│   └── metricStatusCalculator.ts      (新建)
└── types/
    └── networkMetrics.ts              (新建)
```

### 关键功能
1. **状态计算**：根据阈值自动判断指标状态
2. **智能定位**：浮层自动避免超出视口
3. **响应式**：移动端切换为居中模态框
4. **可访问性**：支持键盘导航和屏幕阅读器

---

## 📱 响应式设计

### 桌面端（> 1024px）
- 浮层宽度：320px
- 定位：图标右侧 8px
- 最大高度：400px（超出滚动）

### 平板端（768px - 1024px）
- 浮层宽度：280px
- 定位：智能定位（空间不足时左侧）
- 最大高度：360px

### 移动端（< 768px）
- 浮层宽度：calc(100vw - 32px)
- 定位：屏幕居中
- 添加遮罩层：bg-black/50
- 点击遮罩关闭

---

## ✅ 验收标准

### 功能完整性
- [ ] 所有 5 个指标都有解释内容
- [ ] 信息图标正确显示在 Legend 中
- [ ] 点击图标能正确显示/隐藏浮层
- [ ] 浮层内容完整且格式正确
- [ ] 状态评估准确（基于实际数据）

### 用户体验
- [ ] 解释内容通俗易懂（非专业人员能理解）
- [ ] 浮层定位合理（不遮挡重要信息）
- [ ] 动画流畅自然（无卡顿）
- [ ] 支持多种关闭方式（点击外部、ESC、关闭按钮）

### 视觉一致性
- [ ] 遵循设计规范（配色、字体、间距）
- [ ] 深色模式适配完整
- [ ] 响应式布局正常
- [ ] 状态颜色清晰可辨

### 性能
- [ ] 浮层打开/关闭无卡顿
- [ ] 不影响图表渲染性能
- [ ] 内存占用合理

---

## 🚀 实施计划

### Phase 1: 基础组件（1-2 天）
**目标**：完成核心组件开发

- [ ] 创建类型定义 `networkMetrics.ts`
- [ ] 创建指标配置 `networkMetricsConfig.ts`
- [ ] 创建状态计算工具 `metricStatusCalculator.ts`
- [ ] 创建 `MetricInfoTooltip` 组件
- [ ] 编写单元测试

**交付物**：
- 可独立运行的 `MetricInfoTooltip` 组件
- 完整的 5 个指标配置
- 状态计算逻辑测试通过

---

### Phase 2: 集成与优化（1 天）
**目标**：集成到现有系统

- [ ] 修改 `NetworkCorrelationSidebar` 使用自定义 Legend
- [ ] 集成 `MetricInfoTooltip` 到 Legend
- [ ] 实现指标数据计算（从时间序列数据中提取平均值）
- [ ] 添加状态评估逻辑
- [ ] 集成测试

**交付物**：
- 完整集成的 Network Correlation 组件
- 指标状态实时计算
- 集成测试通过

---

### Phase 3: 交互与动画（0.5 天）
**目标**：优化用户体验

- [ ] 实现智能定位算法
- [ ] 添加淡入/淡出动画
- [ ] 实现响应式适配（桌面/平板/移动）
- [ ] 添加键盘导航支持
- [ ] 优化触摸设备体验

**交付物**：
- 流畅的动画效果
- 完整的响应式支持
- 良好的可访问性

---

### Phase 4: 测试与调优（0.5 天）
**目标**：确保质量

- [ ] 功能测试（所有交互路径）
- [ ] 用户体验测试（非技术人员试用）
- [ ] 性能测试（渲染性能、内存占用）
- [ ] 浏览器兼容性测试
- [ ] 根据反馈调整内容

**交付物**：
- 测试报告
- 性能优化建议
- 用户反馈总结

---

## 📝 后续优化方向

### 短期（1-2 周）
1. **内容优化**：根据用户反馈调整解释内容
2. **视觉优化**：微调颜色、间距、动画
3. **性能优化**：减少重渲染，优化计算逻辑

### 中期（1-2 月）
1. **趋势图**：在浮层中添加小型 Sparkline 显示指标趋势
2. **关联分析**：点击指标可跳转到相关指标
3. **多语言**：支持英文版本

### 长期（3-6 月）
1. **智能建议**：基于 AI 分析提供更精准的问题诊断
2. **导出功能**：支持导出指标说明为 PDF/图片
3. **自定义阈值**：允许用户自定义正常/警告/严重阈值

---

## 📚 相关文档

1. **详细设计文档**：`network-metrics-explanation-design.md`
2. **UI 原型示意**：`network-metrics-ui-mockup.md`
3. **实现指南**：`network-metrics-implementation-guide.md`
4. **设计规范**：`design-token.md`
5. **架构文档**：`mock-api-architecture.md`

---

## 🎓 设计亮点

### 1. 降低认知负担
通过生活化比喻（快递、电话等）让非技术人员快速理解专业概念。

### 2. 建立因果关系
明确说明网络指标变化如何影响交易性能，帮助用户理解问题的业务影响。

### 3. 提供行动指南
异常时给出可能原因，为问题排查提供方向，提高运维效率。

### 4. 渐进式信息披露
默认只显示图标，点击后才显示详细信息，避免信息过载。

### 5. 智能状态评估
自动计算指标状态，用颜色和图标直观展示，降低判断成本。

---

## 💬 用户反馈收集

### 收集渠道
1. **内部测试**：邀请非网络岗位同事试用
2. **用户访谈**：与实际用户进行 1 对 1 访谈
3. **使用数据**：统计哪些指标被点击最多
4. **问卷调查**：收集满意度和改进建议

### 关键指标
- **理解度**：非技术人员能否理解解释内容
- **有用性**：解释内容是否帮助用户定位问题
- **使用率**：信息图标的点击率
- **满意度**：用户对功能的整体满意度

---

## 🎉 预期效果

### 对用户
- **降低学习成本**：无需专业网络知识即可理解指标
- **提高工作效率**：快速判断网络是否为问题根因
- **增强信心**：有依据地进行问题排查和沟通

### 对产品
- **提升易用性**：降低产品使用门槛
- **增强专业性**：体现产品的智能化和人性化
- **扩大用户群**：吸引更多非技术岗位用户

### 对团队
- **减少支持成本**：用户自助解决问题，减少咨询
- **提升口碑**：用户体验好，口碑传播
- **积累经验**：为其他复杂功能提供设计参考

---

## 📞 联系方式

如有疑问或建议，请联系：
- **产品设计**：[产品团队]
- **技术实现**：[开发团队]
- **用户研究**：[UX 团队]

